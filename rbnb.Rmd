---
title: "R BnB"
output: github_document

---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*. 
```{r}
library(OpenStreetMap)
library(leaflet)
library(rgdal)
library(dplyr)
library(htmlwidgets)
library(RColorBrewer)
library(classInt)
library(plotrix)  
library(ggmap)

library(lubridate)
```

```{r}
df_light<-read.csv('data/listings_light.csv')
df_light_2015<-read.csv('data/listings_oct_2015.csv')
```


Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).
```{r}

# pal <- colorQuantile(
#   palette = "Reds",
#   domain = df_light$number_of_reviews,reverse = FALSE)
# 
# m<-leaflet(data = df_light) %>% addTiles() %>%
#   addCircleMarkers(~longitude, ~latitude, popup = ~as.character(name), label = ~as.character(name),stroke = FALSE, fillOpacity = 0.8,color = ~pal(number_of_reviews),radius=2) 
# 
# m
```
## With OSM
```{r fig.width=12, fig.height=12}

df_wedding<-df_light %>% filter(grepl('Mitte',neighbourhood_group))
range_lat<-range(df_wedding$latitude)
range_lon<-range(df_wedding$longitude)

# # téléchargement de la carte
# mapBerlin <- openmap(upperLeft = c(range_lat[1], range_lon[1]), 
#                   lowerRight = c(range_lat[2], range_lon[2]), 
#                   type = "stamen-toner")
# # affichage de la carte


# df_wedding <- cbind(df_wedding,projectMercator(df_wedding$latitude,df_wedding$longitude))

```

```{r fig.width=12, fig.height=12}
ggmap_berlin<- get_map(location = c(left = range_lon[1], bottom = range_lat[1], right =
  range_lon[2], top = range_lat[2]),source="google",color="bw")





```

```{r fig.width=12, fig.height=12}
plot_map<- function(df,title){
col_neighbour<- grep('neigh',colnames(df),value = TRUE)

df_mitte<-df %>% filter(grepl('Mitte',neighbourhood_group))
color_hex_max='#ff5a5f'
color_hex_min ='#0dc24b'
col <- findColours(classIntervals(
          df_mitte$price, 5, style="quantile"),
          smoothColors(color_hex_min,3,color_hex_max)) 


m<-ggmap(ggmap_berlin)+ geom_point(aes(x=longitude, y=latitude), data=df_mitte, col=col)+ggtitle(title)+theme(plot.title = element_text(size = 40, face = "bold"))
return(m)

}
```

```{r fig.width=12, fig.height=12}
filos<- list.files(path = "data/listings/")

for (filo in filos){
  file_path = paste0("data/listings/",filo)
  
  df<-read.csv(file_path, stringsAsFactors = FALSE)
  print(plot_map(df,filo))
}
```





